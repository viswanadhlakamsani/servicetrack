<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Launching Service App</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; text-align: center; padding: 2rem; }
    </style>
</head>
<body>
    <p>Reserving your DS Number. Please wait...</p>

    <script>
        (async function() {
            // üîÅ REPLACE THESE VALUES WITH YOURS
                                    //https://script.google.com/macros/s/AKfycbz0Apo3s06xuQT783-DO6Ge5lGQ1FfQBnBsgh9TBkjDqsEik5FSqP1WLSMJOJ3DPFXp/exec
            const YOUR_SCRIPT_URL = " https://script.google.com/macros/s/AKfycbz0Apo3s06xuQT783-DO6Ge5lGQ1FfQBnBsgh9TBkjDqsEik5FSqP1WLSMJOJ3DPFXp/exec?reserve=1";
            // const YOUR_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby7ARVxdyj6O3GhbEm7V11TyWiIKaykpQVsqsrDm1kmVfIfiv3SQPsUB_GAyY0Rg54zGA/exec?reserve=1";
            
              // const YOUR_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzZoGpZnD08lhnznmq90Xpbw6N7fsHS0QofIOr48qmvtv6jgRW9g8s6luto3xGeTO0O/exec?reserve=1";
            const YOUR_APP_ID = "28a261e5-c7ab-433d-bb25-80251df0928d";
            const YOUR_FORM_NAME = "New%20Vehicle"; // URL-encoded form view name

            try {
                // 1. Call your Apps Script to get a DS number
                //lkv
                console.log("Calling your Apps Script...");
                const response = await fetch(YOUR_SCRIPT_URL);
                
                if (!response.ok) throw new Error(`Network error: ${response.status}`);
                
                const data = await response.json();
                const dsno = data.dsno;

                // 2. Build the AppSheet deep link
                const defaults = encodeURIComponent(JSON.stringify({ DSNo: dsno }));
                const deepLink = `https://www.appsheet.com/start/${YOUR_APP_ID}#control=${YOUR_FORM_NAME}&defaults=${defaults}`;
                
                console.log("Redirecting to AppSheet...");
                
                // 3. PERFORM THE REDIRECT
                window.top.location.href = deepLink;

            } catch (error) {
                // Show a user-friendly error message
                document.body.innerHTML = `
                    <h2>Error</h2>
                    <p>Could not start a new service entry. Please try again.</p>
                    <p><small>Details: ${error.message}</small></p>
                    <a href="#" onclick="window.location.reload()">Click here to retry</a>
                `;
                console.error("Launcher error:", error);
            }
        })();
    </script>
</body>

</html>



